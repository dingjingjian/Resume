(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-03f3dec8"],{"26f4":function(t,e,s){},6496:function(t,e,s){"use strict";s("26f4")},"85ba":function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"forum-detail-view container-card px-2 pb-2"},[e("a-page-header",{attrs:{backIcon:!1},on:{back:function(){return t.$router.go(-1)}},scopedSlots:t._u([{key:"title",fn:function(){return[e("div",{staticClass:"page-header-title",on:{click:function(){return t.$router.go(-1)}}},[e("a-icon",{attrs:{type:"arrow-left"}}),e("span",[t._v("返回")])],1)]},proxy:!0}])}),e("a-spin",{staticClass:"forum-content p-2",attrs:{spinning:t.reloading}},[e("div",{staticClass:"title"},[e("h1",{staticClass:"text"},["0"!==t.ztDiscuss.isMe?e("a-tag",{attrs:{color:"green"}},[t._v(" 我的发表 ")]):t._e(),"0"!==t.ztDiscuss.teaJoin?e("a-tag",{attrs:{color:"orange"}},[t._v(" 老师参与 ")]):t._e(),t._v(" "+t._s(t.ztDiscuss.title)+" ")],1),"1"===t.ztDiscuss.isDelete?e("div",{staticClass:"delete",on:{click:function(e){return t.delForum()}}},[e("span",{staticClass:"iconfont icon-shanchu",staticStyle:{"font-size":"12px"}}),t._v(" 删除 ")]):t._e()]),e("div",{staticClass:"content-html w-e-text mt-1",domProps:{innerHTML:t._s(t.ztDiscuss.content)}}),e("div",{staticClass:"author-info mt-1"},[e("i",{staticClass:"iconfont icon-user-c"}),e("a-popover",[e("span",{directives:[{name:"ellipsis",rawName:"v-ellipsis",value:10,expression:"10"}],staticClass:"author"},[t._v(t._s(t.ztDiscuss.nickName))]),e("template",{slot:"content"},[t._v(" "+t._s(t.ztDiscuss.nickName)+" ")])],2),e("span",[t._v(t._s(t.ztDiscuss.createTime)+" 发表")])],1),e("a-form-model",{ref:"forumReply",attrs:{model:t.form,rules:t.rules}},[e("a-form-model-item",{attrs:{prop:"reply"}},[e("editor",{attrs:{name:"reply"},model:{value:t.form.reply,callback:function(e){t.$set(t.form,"reply",e)},expression:"form.reply"}})],1)],1),e("div",{staticClass:"btn"},[e("a-button",{staticClass:"button-primary",attrs:{type:"primary",loading:t.loading},on:{click:function(e){return t.onSaveReply()}}},[t._v("回复")])],1)],1),e("a-list",{staticClass:"answer-list mt-3 pb-2",attrs:{"item-layout":"vertical","data-source":t.ztAnswerList,loading:t.reloading,rowKey:"id",pagination:t.pagination,locale:{emptyText:"暂无回复"}},scopedSlots:t._u([{key:"header",fn:function(){return[e("h1",{staticClass:"title-text mb-0"},[t._v("共"+t._s(t.ztAnswerList.length)+"个回复")])]},proxy:!0},{key:"renderItem",fn:function(s){return e("a-list-item",{},[e("a-list-item-meta",[e("div",{staticClass:"title",attrs:{slot:"title"},slot:"title"},["1"===s.isMe?e("a-tag",{attrs:{color:"green"}},[t._v(" 我的回复 ")]):t._e(),"1"===s.isTeacher?e("a-tag",{attrs:{color:"orange"}},[t._v(" 老师回复 ")]):t._e(),e("div",{staticClass:"content-html w-e-text",domProps:{innerHTML:t._s(s.content)}})],1),e("div",{staticClass:"description",attrs:{slot:"description"},slot:"description"},[e("div",{staticClass:"info"},[e("i",{staticClass:"iconfont icon-user-c"}),e("a-popover",[e("span",{directives:[{name:"ellipsis",rawName:"v-ellipsis",value:10,expression:"10"}],staticClass:"author"},[t._v(t._s(s.nickName))]),e("template",{slot:"content"},[t._v(" "+t._s(s.nickName)+" ")])],2),e("span",[t._v(t._s(s.createTime))])],1),e("div",{staticClass:"actions"},["1"===s.isDelete?e("div",{staticClass:"delete",on:{click:function(e){return t.onDelReply(s.id)}}},[e("span",{staticClass:"iconfont icon-shanchu"}),t._v(" 删除 ")]):t._e(),e("div",{staticClass:"comment",on:{click:function(e){return t.onReview(s)}}},[e("span",{staticClass:"iconfont icon-zuodacishu"}),t._v(" 评论("+t._s(s.commentList.length)+") ")])])])]),e("div",{staticClass:"show-comment",class:s.commentShow?"show":""},[e("a-form-model",{ref:"commentForm"+s.id,attrs:{model:s.newComment,rules:t.rules}},[e("a-form-model-item",{attrs:{prop:"comment"}},[e("a-textarea",{attrs:{name:"comment",placeholder:"输入评论内容",rows:2},model:{value:s.newComment.comment,callback:function(e){t.$set(s.newComment,"comment",e)},expression:"item.newComment.comment"}})],1)],1),e("a-button",{staticClass:"button-primary",attrs:{type:"primary"},on:{click:function(e){return t.onSaveComment(s)}}},[t._v(" 评论 ")]),s.commentList.length?e("a-list",{staticClass:"comment-list",attrs:{"item-layout":"vertical","data-source":s.commentList,rowKey:"id",locale:{emptyText:"暂无评论"}},scopedSlots:t._u([{key:"renderItem",fn:function(s){return e("a-list-item",{},[e("a-list-item-meta",[e("div",{attrs:{slot:"title"},slot:"title"},["1"===s.isMe?e("a-tag",{attrs:{color:"green"}},[t._v(" 我的评论 ")]):t._e(),"1"===s.isTeacher?e("a-tag",{attrs:{color:"orange"}},[t._v(" 老师评论 ")]):t._e(),t._v(" "+t._s(s.content)+" ")],1),e("div",{staticClass:"description",attrs:{slot:"description"},slot:"description"},[e("div",{staticClass:"info"},[e("i",{staticClass:"iconfont icon-user-c"}),e("a-popover",[e("span",{directives:[{name:"ellipsis",rawName:"v-ellipsis",value:10,expression:"10"}],staticClass:"author"},[t._v(t._s(s.nickName))]),e("template",{slot:"content"},[t._v(" "+t._s(s.nickName)+" ")])],2),e("span",[t._v(t._s(s.createTime))])],1),e("div",{staticClass:"actions"},["1"===s.isDelete?e("div",{staticClass:"delete",on:{click:function(e){return t.onDelComment(s.id)}}},[e("span",{staticClass:"iconfont icon-shanchu"}),t._v(" 删除 ")]):t._e()])])])],1)}}],null,!0)}):t._e()],1)],1)}}])})],1)},a=[],i=s("f07e"),r=s("c964"),o=(s("cd17"),s("ed3b")),c=s("f3f3"),l=(s("d3b7"),s("d81d"),s("ac16"),s("ac1f"),s("5319"),s("8540")),m=s("2443"),u=s("5d2d"),d=s("5880"),p={name:"ForumDetail",components:{Editor:m["a"]},data:function(){this.$createElement;return{ztDiscuss:{},form:{reply:""},rules:{reply:[{required:!0,message:"回复内容不能为空",trigger:"change"},{max:1e4,message:"最多输入10000字（包含格式）",trigger:"change"}],comment:[{required:!0,message:"评论内容不能为空",trigger:"change"},{max:1e4,message:"最多输入200字",trigger:"change"}]},ztAnswerList:[],loading:!1,reloading:!1,pagination:{hideOnSinglePage:!0,pageSize:10,itemRender:function(t,e,s){var n=this.$createElement;return"prev"===e?n("a-button",["上一页"]):"next"===e?n("a-button",["下一页"]):s}}}},computed:Object(c["a"])({},Object(d["mapGetters"])(["username"])),methods:{getDetail:function(){var t=this;this.reloading=!0,Object(l["e"])(this.$route.params.id).then((function(e){var s=e.data;Object.assign(t.ztDiscuss,s.ztDiscuss);var n=[];s.ztAnswerList&&(s.ztAnswerList.map((function(e){e.newComment={comment:""},e.commentShow=!1;for(var s=0;s<t.ztAnswerList.length;s++){var a=t.ztAnswerList[s];if(e.id===a.id){e.commentShow=a.commentShow||!1,e.newComment.comment=a.newComment.comment||"";break}}n.push(e)})),t.ztAnswerList=n)})).finally((function(){t.reloading=!1}))},onReview:function(t){t.commentShow=!t.commentShow},onSaveReply:function(){var t=this;this.$refs.forumReply.validate((function(e){if(!e)return!1;var s={discussId:t.ztDiscuss.id,content:t.form.reply};t.loading=!0,Object(l["g"])(s).then((function(e){t.$refs.forumReply.resetFields(),t.$message.success(e.msg),t.getDetail(),t.form.reply="";var s=u["a"].getProps("forum-detail-form",t.username)||{};s&&Reflect.deleteProperty(s[t.ztDiscuss.id]),u["a"].setProps("forum-detail-form",t.username,s)})).finally((function(){t.loading=!1}))}))},onDelReply:function(t){var e=this;o["a"].confirm({title:"删除回复",content:"您确定要删除该条回复吗？",centered:!0,onOk:function(){return Object(r["a"])(Object(i["a"])().mark((function s(){return Object(i["a"])().wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,Object(l["b"])(t);case 3:e.$message.success("删除回复成功"),e.getDetail(),s.next=10;break;case 7:s.prev=7,s.t0=s["catch"](0),e.$message.error("删除回复失败");case 10:case"end":return s.stop()}}),s,null,[[0,7]])})))()}})},onSaveComment:function(t){var e=this;this.$refs["commentForm"+t.id].validate((function(s){if(!s)return!1;var n={answerId:t.id,content:t.newComment.comment};e.loading=!0,Object(l["h"])(n).then((function(s){e.$refs["commentForm"+t.id].resetFields(),e.$message.success(s.msg),e.getDetail()})).finally((function(){e.loading=!1}))})),this.isNoComment},onDelComment:function(t){var e=this;o["a"].confirm({title:"删除评论",content:"您确定要删除该条评论吗？",centered:!0,onOk:function(){return Object(r["a"])(Object(i["a"])().mark((function s(){return Object(i["a"])().wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,Object(l["c"])(t);case 3:e.$message.success("删除评论成功"),e.getDetail(),s.next=10;break;case 7:s.prev=7,s.t0=s["catch"](0),e.$message.error("删除评论失败");case 10:case"end":return s.stop()}}),s,null,[[0,7]])})))()}})},delForum:function(){var t=this;o["a"].confirm({title:"删除主题",content:"您确定要删除该条主题吗？",centered:!0,onOk:function(){return Object(r["a"])(Object(i["a"])().mark((function e(){return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(l["d"])(t.ztDiscuss.id);case 3:t.$message.success("删除主题成功"),t.$router.replace("/index/forum"),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),t.$message.error("删除主题失败");case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()}})}},created:function(){this.getDetail();var t=u["a"].getProps("forum-detail-form",this.username);t&&Object.assign(this.form,t[this.$route.params.id])},beforeDestroy:function(){var t=u["a"].getProps("forum-detail-form",this.username)||{};t&&(t[this.ztDiscuss.id]=this.form),u["a"].setProps("forum-detail-form",this.username,t)}},f=p,v=(s("6496"),s("2877")),g=Object(v["a"])(f,n,a,!1,null,"35d7cd6d",null);e["default"]=g.exports}}]);